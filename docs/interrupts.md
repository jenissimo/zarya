# Система прерываний

## Общее описание

Машина Заря поддерживает систему прерываний для обработки исключительных ситуаций и взаимодействия с внешними устройствами. 

## Типы прерываний

### Аппаратные прерывания
- INT 0: Сброс процессора
- INT 1: Ошибка деления на ноль
- INT 2: Переполнение стека
- INT 3: Недостаточно данных в стеке
- INT 4: Неверный опкод
- INT 5: Нарушение доступа к памяти

### Программные прерывания
- INT 16: Ввод символа с клавиатуры
- INT 17: Вывод символа на экран
- INT 18: Чтение строки
- INT 19: Вывод строки
- INT 20: Чтение числа
- INT 21: Вывод числа

## Обработка прерываний

При возникновении прерывания:
1. Текущее состояние процессора сохраняется в стеке:
   - Регистр команд (PC)
   - Регистр флагов (FLAGS)
   - Регистр указателя стека (SP)
2. Управление передается обработчику прерывания
3. После обработки выполняется команда IRET для возврата

## Таблица векторов прерываний

Таблица векторов прерываний располагается в начале памяти и содержит адреса обработчиков:

```
Адрес | Прерывание
------+------------
0000  | INT 0 (Reset)
0001  | INT 1 (Div0)
0002  | INT 2 (Stack)
...   | ...
```

## Пример обработчика

```asm
; Обработчик прерывания вывода символа (INT 17)
print_char:
    PUSH R0         ; Сохраняем регистры
    PUSH R1
    
    POP R0          ; Получаем символ из стека
    ; Код вывода символа
    
    POP R1          ; Восстанавливаем регистры
    POP R0
    IRET            ; Возврат из прерывания
```

## Маскирование прерываний

Регистр флагов содержит бит IE (Interrupt Enable):
- IE=1: Прерывания разрешены
- IE=0: Прерывания запрещены

Команды управления:
- CLI - запретить прерывания (Clear Interrupt)
- STI - разрешить прерывания (Set Interrupt) 