# Система команд

## Базовые инструкции

### Стековые операции
- PUSH value - положить значение в стек
- POP reg - снять значение со стека в регистр
- DUP - дублировать верхнее значение стека
- SWAP - поменять местами два верхних значения
- DROP - удалить верхнее значение
- OVER - скопировать предпоследнее значение

### Арифметические операции
- ADD - сложение (a b -- a+b)
- SUB - вычитание (a b -- a-b)
- MUL - умножение (a b -- a*b)
- DIV - деление (a b -- a/b)

### Логические операции
- AND - логическое И
- OR - логическое ИЛИ
- NOT - логическое НЕ

### Операции сравнения
- EQ - равно (a b -- a==b)
- NEQ - не равно (a b -- a!=b)
- LT - меньше (a b -- a<b)
- GT - больше (a b -- a>b)
- LE - меньше или равно (a b -- a<=b)
- GE - больше или равно (a b -- a>=b)

### Операции с памятью
- LOAD addr - загрузить значение из памяти в стек
- STORE addr - сохранить значение из стека в память

### Управление потоком
- JMP addr - безусловный переход
- JZ addr - переход если ноль
- JNZ addr - переход если не ноль
- CALL addr - вызов подпрограммы
- RET - возврат из подпрограммы

### Системные инструкции
- INT num - вызов прерывания
- HALT - остановка процессора
- NOP - нет операции

## Псевдоинструкции

### Работа с регистрами
```
; Пересылка данных
MOV dst, src   -> PUSH src; POP dst    ; Копирование значения
INC reg        -> PUSH reg; PUSH 1; ADD; POP reg
DEC reg        -> PUSH reg; PUSH 1; SUB; POP reg

; Арифметика с регистрами
ADD reg        -> PUSH reg; ADD; POP reg    ; Сложить с вершиной стека
SUB reg        -> PUSH reg; SUB; POP reg    ; Вычесть из регистра
```

### Управление стеком
```
PUSHR reg      -> PUSH reg     ; Явное указание работы с регистром
POPR reg       -> POP reg      ; Явное указание работы с регистром
CLEAR n        -> DROP × n     ; Очистка N элементов стека
```

### Сравнения и тесты
```
CMP a, b       -> PUSH a; PUSH b; SUB    ; Сравнение (результат в стеке)
TEST val       -> PUSH val; DUP; AND     ; Проверка битов
```

### Работа с памятью
```
PEEK addr      -> PUSH addr; LOAD        ; Загрузка значения в стек
POKE addr      -> PUSH addr; STORE       ; Сохранение значения из стека
```

## Режимы адресации

Машина Заря поддерживает следующие режимы адресации операндов:

1. Непосредственный (#value):
   ```asm
   PUSH #42    ; Положить число 42 в стек
   MOV R0, #5  ; Записать 5 в R0
   ```

2. Регистровый (Rn):
   ```asm
   PUSH R0     ; Положить значение из R0 в стек
   MOV R1, R0  ; Копировать из R0 в R1
   ```

3. Косвенный через регистр (@Rn):
   ```asm
   PUSH @R0    ; Положить значение из памяти по адресу в R0
   MOV R1, @R0 ; Загрузить в R1 значение из памяти по адресу в R0
   ```

## Формат инструкций

Каждая инструкция состоит из трех трайтов:
- Опкод (1 трайт)
- Первый операнд (1 трайт)
- Второй операнд (1 трайт)

### Структура опкода
```
+-------------+----------------+
| Режим адр.  | Базовый опкод |
| (1 трит)    | (остальные)   |
+-------------+----------------+ 